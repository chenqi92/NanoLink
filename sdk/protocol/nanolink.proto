syntax = "proto3";
package nanolink;

option go_package = "github.com/chenqi92/NanoLink/sdk/go/nanolink/proto";
option java_package = "io.nanolink.proto";
option java_multiple_files = true;

// ========== Message Envelope ==========
message Envelope {
  uint64 timestamp = 1;
  string message_id = 2;
  oneof payload {
    AuthRequest auth_request = 10;
    AuthResponse auth_response = 11;
    Metrics metrics = 20;
    MetricsSync metrics_sync = 21;
    Command command = 30;
    CommandResult command_result = 31;
    Heartbeat heartbeat = 40;
    HeartbeatAck heartbeat_ack = 41;
  }
}

// ========== Authentication ==========
message AuthRequest {
  string token = 1;
  string hostname = 2;
  string agent_version = 3;
  string os = 4;
  string arch = 5;
}

message AuthResponse {
  bool success = 1;
  int32 permission_level = 2;  // 0=READ_ONLY, 1=BASIC_WRITE, 2=SERVICE_CONTROL, 3=SYSTEM_ADMIN
  string error_message = 3;
}

// ========== Metrics Type ==========
// Defines what type of metrics data is being sent
enum MetricsType {
  METRICS_FULL = 0;      // Complete data (first connection or on request)
  METRICS_REALTIME = 1;  // Realtime data only (CPU/memory/network IO/GPU usage)
  METRICS_PERIODIC = 2;  // Periodic data (disk usage, user sessions)
  METRICS_STATIC = 3;    // Static data (hardware info, system info)
}

// ========== Data Request Types ==========
// Commands from server to agent to request specific data
enum DataRequestType {
  DATA_REQUEST_FULL = 0;           // Request complete metrics
  DATA_REQUEST_STATIC = 1;         // Request static hardware/system info
  DATA_REQUEST_DISK_USAGE = 2;     // Request disk capacity/usage
  DATA_REQUEST_NETWORK_INFO = 3;   // Request network info (IPs, MACs)
  DATA_REQUEST_USER_SESSIONS = 4;  // Request user sessions
  DATA_REQUEST_GPU_INFO = 5;       // Request GPU static info
  DATA_REQUEST_HEALTH = 6;         // Request disk S.M.A.R.T status
}

// Data request message from server to agent
message DataRequest {
  DataRequestType request_type = 1;
  string target = 2;  // Optional: specific device/interface name
}

// ========== Complete Metrics (for first connection or full request) ==========
message Metrics {
  uint64 timestamp = 1;
  CpuMetrics cpu = 2;
  MemoryMetrics memory = 3;
  repeated DiskMetrics disks = 4;
  repeated NetworkMetrics networks = 5;
  repeated double load_average = 6;  // [1min, 5min, 15min]
  string hostname = 7;
  repeated GpuMetrics gpus = 8;
  SystemInfo system_info = 9;
  repeated UserSession user_sessions = 10;  // Logged-in users
  repeated NpuMetrics npus = 11;            // AI accelerators (NPU/TPU)
  MetricsType metrics_type = 12;            // Type of this metrics message
  bool is_initial = 13;                      // True if this is initial full data
}

// ========== Realtime Metrics (sent every second) ==========
// Lightweight message for frequently changing data
message RealtimeMetrics {
  uint64 timestamp = 1;
  double cpu_usage_percent = 2;
  repeated double cpu_per_core = 3;
  double cpu_temperature = 4;
  uint64 cpu_frequency_mhz = 5;      // Current frequency
  uint64 memory_used = 6;
  uint64 memory_cached = 7;
  uint64 swap_used = 8;
  repeated DiskIO disk_io = 9;
  repeated NetworkIO network_io = 10;
  repeated double load_average = 11;
  repeated GpuUsage gpu_usage = 12;
  repeated NpuUsage npu_usage = 13;
}

// Disk IO metrics (realtime)
message DiskIO {
  string device = 1;
  uint64 read_bytes_sec = 2;
  uint64 write_bytes_sec = 3;
  uint64 read_iops = 4;
  uint64 write_iops = 5;
}

// Network IO metrics (realtime)
message NetworkIO {
  string interface = 1;
  uint64 rx_bytes_sec = 2;
  uint64 tx_bytes_sec = 3;
  uint64 rx_packets_sec = 4;
  uint64 tx_packets_sec = 5;
  bool is_up = 6;
}

// GPU usage metrics (realtime)
message GpuUsage {
  uint32 index = 1;
  double usage_percent = 2;
  uint64 memory_used = 3;
  double temperature = 4;
  uint32 power_watts = 5;
  uint64 clock_core_mhz = 6;
  double encoder_usage = 7;
  double decoder_usage = 8;
}

// NPU usage metrics (realtime)
message NpuUsage {
  uint32 index = 1;
  double usage_percent = 2;
  uint64 memory_used = 3;
  double temperature = 4;
  uint32 power_watts = 5;
}

// ========== Static Hardware Info (sent once or on request) ==========
message StaticInfo {
  uint64 timestamp = 1;
  CpuStaticInfo cpu = 2;
  MemoryStaticInfo memory = 3;
  repeated DiskStaticInfo disks = 4;
  repeated NetworkStaticInfo networks = 5;
  repeated GpuStaticInfo gpus = 6;
  repeated NpuStaticInfo npus = 7;
  SystemInfo system_info = 8;
  string agent_version = 9;  // Agent version for tracking
}

message CpuStaticInfo {
  string model = 1;
  string vendor = 2;
  uint32 physical_cores = 3;
  uint32 logical_cores = 4;
  string architecture = 5;
  uint64 frequency_max_mhz = 6;
  uint64 l1_cache_kb = 7;
  uint64 l2_cache_kb = 8;
  uint64 l3_cache_kb = 9;
}

message MemoryStaticInfo {
  uint64 total = 1;
  uint64 swap_total = 2;
  string memory_type = 3;
  uint32 memory_speed_mhz = 4;
  uint32 memory_slots = 5;
}

message DiskStaticInfo {
  string device = 1;
  string mount_point = 2;
  string fs_type = 3;
  string model = 4;
  string serial = 5;
  string disk_type = 6;      // SSD, HDD, NVMe
  uint64 total_bytes = 7;
  string health_status = 8;  // S.M.A.R.T status
}

message NetworkStaticInfo {
  string interface = 1;
  string mac_address = 2;
  repeated string ip_addresses = 3;
  uint64 speed_mbps = 4;
  string interface_type = 5;  // ethernet, wifi, loopback, virtual
  bool is_virtual = 6;
}

message GpuStaticInfo {
  uint32 index = 1;
  string name = 2;
  string vendor = 3;
  uint64 memory_total = 4;
  string driver_version = 5;
  string pcie_generation = 6;
  uint32 power_limit_watts = 7;
}

message NpuStaticInfo {
  uint32 index = 1;
  string name = 2;
  string vendor = 3;
  uint64 memory_total = 4;
  string driver_version = 5;
}

// ========== Periodic Data (disk usage, user sessions) ==========
message PeriodicData {
  uint64 timestamp = 1;
  repeated DiskUsage disk_usage = 2;
  repeated UserSession user_sessions = 3;
  repeated NetworkAddressUpdate network_updates = 4;
}

message DiskUsage {
  string device = 1;
  string mount_point = 2;
  uint64 total = 3;
  uint64 used = 4;
  uint64 available = 5;
  double temperature = 6;
}

message NetworkAddressUpdate {
  string interface = 1;
  repeated string ip_addresses = 2;
  bool is_up = 3;
}

message CpuMetrics {
  double usage_percent = 1;
  uint32 core_count = 2;
  repeated double per_core_usage = 3;
  string model = 4;              // CPU model name (e.g., "Intel Core i7-12700K")
  string vendor = 5;             // CPU vendor (e.g., "Intel", "AMD")
  uint64 frequency_mhz = 6;      // Current frequency in MHz
  uint64 frequency_max_mhz = 7;  // Max frequency in MHz
  uint32 physical_cores = 8;     // Physical core count
  uint32 logical_cores = 9;      // Logical core count (with HT)
  string architecture = 10;      // Architecture (e.g., "x86_64", "aarch64")
  double temperature = 11;       // CPU temperature in Celsius (if available)
}

message MemoryMetrics {
  uint64 total = 1;
  uint64 used = 2;
  uint64 available = 3;
  uint64 swap_total = 4;
  uint64 swap_used = 5;
  uint64 cached = 6;             // Cached memory
  uint64 buffers = 7;            // Buffer memory (Linux)
  string memory_type = 8;        // Memory type (e.g., "DDR4", "DDR5")
  uint32 memory_speed_mhz = 9;   // Memory speed in MHz
}

message DiskMetrics {
  string mount_point = 1;
  string device = 2;
  string fs_type = 3;
  uint64 total = 4;
  uint64 used = 5;
  uint64 available = 6;
  uint64 read_bytes_sec = 7;
  uint64 write_bytes_sec = 8;
  string model = 9;              // Disk model (e.g., "Samsung SSD 970 EVO Plus")
  string serial = 10;            // Disk serial number
  string disk_type = 11;         // Disk type ("SSD", "HDD", "NVMe")
  uint64 read_iops = 12;         // Read IOPS
  uint64 write_iops = 13;        // Write IOPS
  double temperature = 14;       // Disk temperature in Celsius (if available)
  string health_status = 15;     // S.M.A.R.T health status
}

message NetworkMetrics {
  string interface = 1;
  uint64 rx_bytes_sec = 2;
  uint64 tx_bytes_sec = 3;
  uint64 rx_packets_sec = 4;
  uint64 tx_packets_sec = 5;
  bool is_up = 6;
  string mac_address = 7;        // MAC address
  repeated string ip_addresses = 8;  // IP addresses (IPv4 and IPv6)
  uint64 speed_mbps = 9;         // Link speed in Mbps
  string interface_type = 10;    // Type: "ethernet", "wifi", "loopback", "virtual"
}

message GpuMetrics {
  uint32 index = 1;              // GPU index
  string name = 2;               // GPU model name (e.g., "NVIDIA GeForce RTX 4090")
  string vendor = 3;             // GPU vendor ("NVIDIA", "AMD", "Intel")
  double usage_percent = 4;      // GPU utilization percentage
  uint64 memory_total = 5;       // Total VRAM in bytes
  uint64 memory_used = 6;        // Used VRAM in bytes
  double temperature = 7;        // GPU temperature in Celsius
  uint32 fan_speed_percent = 8;  // Fan speed percentage
  uint32 power_watts = 9;        // Current power draw in watts
  uint32 power_limit_watts = 10; // Power limit in watts
  uint64 clock_core_mhz = 11;    // Core clock in MHz
  uint64 clock_memory_mhz = 12;  // Memory clock in MHz
  string driver_version = 13;    // Driver version
  string pcie_generation = 14;   // PCIe generation (e.g., "Gen4 x16")
  double encoder_usage = 15;     // Encoder utilization (NVENC/VCE)
  double decoder_usage = 16;     // Decoder utilization (NVDEC/VCN)
}

message SystemInfo {
  string os_name = 1;            // OS name (e.g., "Windows 11", "Ubuntu 22.04")
  string os_version = 2;         // OS version
  string kernel_version = 3;     // Kernel version
  string hostname = 4;           // Hostname
  uint64 boot_time = 5;          // System boot time (Unix timestamp)
  uint64 uptime_seconds = 6;     // System uptime in seconds
  string motherboard_model = 7;  // Motherboard model
  string motherboard_vendor = 8; // Motherboard vendor
  string bios_version = 9;       // BIOS version
  string system_model = 10;      // System model (for branded PCs/servers)
  string system_vendor = 11;     // System vendor
}

message UserSession {
  string username = 1;           // Username
  string tty = 2;                // TTY/terminal (e.g., "pts/0", "console")
  uint64 login_time = 3;         // Login time (Unix timestamp)
  string remote_host = 4;        // Remote host for SSH sessions (IP or hostname)
  uint64 idle_seconds = 5;       // Idle time in seconds
  string session_type = 6;       // Session type: "local", "ssh", "rdp", "console"
}

message NpuMetrics {
  uint32 index = 1;              // NPU index
  string name = 2;               // NPU model name (e.g., "Intel NPU", "Ascend 910B")
  string vendor = 3;             // NPU vendor ("Intel", "Huawei", "Qualcomm")
  double usage_percent = 4;      // NPU utilization percentage
  uint64 memory_total = 5;       // Total memory in bytes
  uint64 memory_used = 6;        // Used memory in bytes
  double temperature = 7;        // Temperature in Celsius
  uint32 power_watts = 8;        // Current power draw in watts
  string driver_version = 9;     // Driver version
}

// ========== Metrics Sync (for reconnection) ==========
message MetricsSync {
  uint64 last_sync_timestamp = 1;  // Request: last synced timestamp
  repeated Metrics buffered_metrics = 2;  // Response: buffered data
}

// ========== Commands ==========
message Command {
  string command_id = 1;
  CommandType type = 2;
  string target = 3;  // process name/service name/container name/file path
  map<string, string> params = 4;
  string super_token = 5;  // Required for SHELL_EXECUTE
}

enum CommandType {
  COMMAND_TYPE_UNSPECIFIED = 0;
  // Process Management
  PROCESS_LIST = 1;
  PROCESS_KILL = 2;
  // Service Management
  SERVICE_START = 10;
  SERVICE_STOP = 11;
  SERVICE_RESTART = 12;
  SERVICE_STATUS = 13;
  // File Operations
  FILE_TAIL = 20;
  FILE_DOWNLOAD = 21;
  FILE_UPLOAD = 22;
  FILE_TRUNCATE = 23;
  // Docker Operations
  DOCKER_LIST = 30;
  DOCKER_START = 31;
  DOCKER_STOP = 32;
  DOCKER_RESTART = 33;
  DOCKER_LOGS = 34;
  // System Operations
  SYSTEM_REBOOT = 40;
  // Shell Command (requires SuperToken)
  SHELL_EXECUTE = 50;
  // Agent Self-Upgrade Operations (requires SYSTEM_ADMIN permission)
  AGENT_CHECK_UPDATE = 60;    // Check for available updates
  AGENT_DOWNLOAD_UPDATE = 61; // Download update package
  AGENT_APPLY_UPDATE = 62;    // Apply update and restart agent
  AGENT_GET_VERSION = 63;     // Get current agent version info

  // ========== DevOps Extension Commands ==========
  // Log Query Commands (Level 0/1+ with sanitization)
  SERVICE_LOGS = 70;          // Query journald/systemd service logs
  SYSTEM_LOGS = 71;           // Query /var/log system logs
  AUDIT_LOGS = 72;            // Query auditd audit logs
  LOG_STREAM = 73;            // Realtime log stream (tail -f)

  // Package Management Commands
  PACKAGE_LIST = 80;          // List installed packages
  PACKAGE_CHECK_UPDATES = 81; // Check for available updates
  PACKAGE_UPDATE = 82;        // Update specific package (SYSTEM_ADMIN)
  SYSTEM_UPDATE = 83;         // Full system update (SYSTEM_ADMIN)

  // Script Execution Commands
  SCRIPT_LIST = 90;           // List available scripts
  SCRIPT_EXECUTE = 91;        // Execute predefined script
  SCRIPT_UPLOAD = 92;         // Upload new script (SYSTEM_ADMIN)

  // Config Management Commands
  CONFIG_READ = 100;          // Read config file
  CONFIG_WRITE = 101;         // Write config file (with backup)
  CONFIG_VALIDATE = 102;      // Validate config syntax
  CONFIG_ROLLBACK = 103;      // Rollback to previous version
  CONFIG_LIST_BACKUPS = 104;  // List available backups

  // Health Check Commands
  HEALTH_CHECK = 110;         // Custom health check
  CONNECTIVITY_TEST = 111;    // Network connectivity test
}

message CommandResult {
  string command_id = 1;
  bool success = 2;
  string output = 3;
  string error = 4;
  bytes file_content = 5;  // Used for file download
  repeated ProcessInfo processes = 6;  // Used for PROCESS_LIST
  repeated ContainerInfo containers = 7;  // Used for DOCKER_LIST
  UpdateInfo update_info = 8;  // Used for AGENT_CHECK_UPDATE/GET_VERSION
  // DevOps extension result fields
  LogQueryResult log_result = 10;           // For SERVICE_LOGS/SYSTEM_LOGS/AUDIT_LOGS
  repeated PackageInfo packages = 11;       // For PACKAGE_LIST/PACKAGE_CHECK_UPDATES
  repeated ScriptInfo scripts = 12;         // For SCRIPT_LIST
  ConfigResult config_result = 13;          // For CONFIG_READ/CONFIG_WRITE/CONFIG_ROLLBACK
  HealthCheckResult health_result = 14;     // For HEALTH_CHECK/CONNECTIVITY_TEST
}

// ========== DevOps Extension Messages ==========

// LogQueryResult contains log query results with sanitization info
message LogQueryResult {
  repeated LogEntry lines = 1;
  int64 total_lines = 2;           // Total matching lines (before limit)
  string log_source = 3;           // Source: "journald", "syslog", "audit"
  bool sanitized = 4;              // Whether sensitive data was redacted
  int32 sanitized_count = 5;       // Number of redacted entries
  string start_time = 6;           // Query start time (ISO 8601)
  string end_time = 7;             // Query end time (ISO 8601)
}

// LogEntry represents a single log line
message LogEntry {
  string timestamp = 1;            // Log timestamp (ISO 8601)
  string level = 2;                // Log level: debug, info, warning, error, critical
  string source = 3;               // Source unit/service/file
  string message = 4;              // Log message (sanitized if needed)
  map<string, string> metadata = 5; // Additional metadata (PID, hostname, etc.)
}

// PackageInfo contains information about a system package
message PackageInfo {
  string name = 1;
  string version = 2;
  string description = 3;
  string architecture = 4;
  int64 installed_size = 5;        // Size in bytes
  string install_date = 6;         // Install date (ISO 8601)
  bool update_available = 7;
  string new_version = 8;          // New version if update available
  string repository = 9;           // Package repository/source
  string package_manager = 10;     // apt, yum, dnf, pacman, brew, etc.
}

// ScriptInfo contains information about a predefined script
message ScriptInfo {
  string name = 1;
  string description = 2;
  string category = 3;             // Category: maintenance, monitoring, backup, etc.
  repeated string required_args = 4;  // Required argument names
  int32 required_permission = 5;   // Minimum permission level required
  string checksum = 6;             // SHA256 checksum for verification
  int64 file_size = 7;
  string last_modified = 8;        // Last modified time (ISO 8601)
  bool signature_verified = 9;     // Whether signature is verified
}

// ConfigResult contains config operation results
message ConfigResult {
  string path = 1;                 // Config file path
  string content = 2;              // Config content (for read)
  bool sanitized = 3;              // Whether sensitive data was redacted
  string backup_path = 4;          // Backup file path (for write)
  repeated ConfigBackup backups = 5;  // Available backups (for list)
  bool valid = 6;                  // Syntax validation result
  string validation_error = 7;     // Syntax error message if invalid
}

// ConfigBackup represents a config backup
message ConfigBackup {
  string path = 1;
  string created_at = 2;           // Backup creation time (ISO 8601)
  int64 size = 3;
  string checksum = 4;             // SHA256 checksum
}

// HealthCheckResult contains health check results
message HealthCheckResult {
  bool healthy = 1;
  repeated HealthCheckItem checks = 2;
}

// HealthCheckItem represents a single health check
message HealthCheckItem {
  string name = 1;
  bool passed = 2;
  string message = 3;
  int64 duration_ms = 4;           // Check duration
  map<string, string> details = 5; // Additional details
}

// UpdateInfo contains agent version and update information
message UpdateInfo {
  string current_version = 1;       // Current agent version
  string latest_version = 2;        // Latest available version
  bool update_available = 3;        // Whether an update is available
  string download_url = 4;          // URL to download the update
  string changelog = 5;             // Changelog for the update
  string release_date = 6;          // Release date (ISO 8601)
  int64 download_size = 7;          // Download size in bytes
  string checksum = 8;              // SHA256 checksum of the update file
  string min_version = 9;           // Minimum version required to update
}

message ProcessInfo {
  uint32 pid = 1;
  string name = 2;
  string user = 3;
  double cpu_percent = 4;
  uint64 memory_bytes = 5;
  string status = 6;
  uint64 start_time = 7;
}

message ContainerInfo {
  string id = 1;
  string name = 2;
  string image = 3;
  string status = 4;
  string state = 5;
  uint64 created = 6;
}

// ========== Heartbeat ==========
message Heartbeat {
  uint64 timestamp = 1;
  uint64 uptime_seconds = 2;
}

message HeartbeatAck {
  uint64 timestamp = 1;
}

// ========================================================================
// gRPC Service Definitions
// ========================================================================

// NanoLinkService is the main gRPC service for Agent-Server communication
service NanoLinkService {
  // Authenticate authenticates the agent and returns permission level
  rpc Authenticate(AuthRequest) returns (AuthResponse);

  // StreamMetrics is a bidirectional stream for metrics upload and command dispatch
  // Agent streams metrics to server, server streams commands to agent
  rpc StreamMetrics(stream MetricsStreamRequest) returns (stream MetricsStreamResponse);

  // ReportMetrics is a simple unary RPC for one-time metrics report
  rpc ReportMetrics(Metrics) returns (MetricsAck);

  // ExecuteCommand sends a command to the agent and waits for result
  rpc ExecuteCommand(Command) returns (CommandResult);

  // Heartbeat keeps the connection alive
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);

  // SyncMetrics syncs buffered metrics after reconnection
  rpc SyncMetrics(MetricsSyncRequest) returns (MetricsSyncResponse);

  // GetAgentInfo returns current agent information
  rpc GetAgentInfo(AgentInfoRequest) returns (AgentInfoResponse);
}

// ========== gRPC Request/Response Messages ==========

// MetricsStreamRequest is sent by agent in the bidirectional stream
message MetricsStreamRequest {
  oneof request {
    Metrics metrics = 1;               // Full metrics data (initial or on request)
    Heartbeat heartbeat = 2;           // Heartbeat to keep stream alive
    CommandResult command_result = 3;  // Result of executed command
    RealtimeMetrics realtime = 4;      // Realtime metrics (sent every second)
    StaticInfo static_info = 5;        // Static hardware info (on connect or request)
    PeriodicData periodic = 6;         // Periodic data (disk usage, sessions)
  }
}

// MetricsStreamResponse is sent by server in the bidirectional stream
message MetricsStreamResponse {
  oneof response {
    Command command = 1;               // Command to execute
    HeartbeatAck heartbeat_ack = 2;    // Heartbeat acknowledgment
    ServerConfig config_update = 3;    // Configuration update from server
    DataRequest data_request = 4;      // Request for specific data from agent
  }
}

// MetricsAck acknowledges receipt of metrics
message MetricsAck {
  bool success = 1;
  uint64 timestamp = 2;
}

// HeartbeatRequest for unary heartbeat RPC
message HeartbeatRequest {
  string agent_id = 1;
  uint64 timestamp = 2;
  uint64 uptime_seconds = 3;
}

// HeartbeatResponse for unary heartbeat RPC
message HeartbeatResponse {
  uint64 server_timestamp = 1;
  bool config_changed = 2;
}

// MetricsSyncRequest requests buffered metrics sync
message MetricsSyncRequest {
  string agent_id = 1;
  uint64 last_sync_timestamp = 2;
}

// MetricsSyncResponse contains buffered metrics
message MetricsSyncResponse {
  bool success = 1;
  repeated Metrics metrics = 2;
  uint64 server_timestamp = 3;
}

// AgentInfoRequest requests agent information
message AgentInfoRequest {
  string agent_id = 1;
}

// AgentInfoResponse contains agent information
message AgentInfoResponse {
  string agent_id = 1;
  string hostname = 2;
  string os = 3;
  string arch = 4;
  string version = 5;
  int32 permission_level = 6;
  uint64 connected_at = 7;
  uint64 last_metrics_at = 8;
  repeated string connected_servers = 9;
}

// ServerConfig allows server to push configuration updates
message ServerConfig {
  uint64 metrics_interval_ms = 1;
  uint64 heartbeat_interval_ms = 2;
  bool enable_detailed_metrics = 3;
  repeated string enabled_collectors = 4;
}

// ========================================================================
// Dashboard Service (WebSocket-compatible, also available via gRPC-Web)
// ========================================================================

// DashboardService provides real-time data for web dashboards
service DashboardService {
  // WatchAgents streams agent connection/disconnection events
  rpc WatchAgents(WatchAgentsRequest) returns (stream AgentEvent);

  // WatchMetrics streams real-time metrics for specified agents
  rpc WatchMetrics(WatchMetricsRequest) returns (stream Metrics);

  // GetAgents returns list of connected agents
  rpc GetAgents(GetAgentsRequest) returns (GetAgentsResponse);

  // GetAgentMetrics returns current metrics for an agent
  rpc GetAgentMetrics(GetAgentMetricsRequest) returns (Metrics);

  // SendCommand sends command to agent through dashboard
  rpc SendCommand(DashboardCommandRequest) returns (CommandResult);
}

// WatchAgentsRequest to start watching agent events
message WatchAgentsRequest {
  bool include_initial = 1;  // Include current agents in stream
}

// AgentEvent represents agent connection/disconnection
message AgentEvent {
  enum EventType {
    CONNECTED = 0;
    DISCONNECTED = 1;
    UPDATED = 2;
  }
  EventType event_type = 1;
  AgentInfoResponse agent = 2;
  uint64 timestamp = 3;
}

// WatchMetricsRequest to start watching metrics
message WatchMetricsRequest {
  repeated string agent_ids = 1;  // Empty means all agents
  uint64 interval_ms = 2;         // Minimum interval between updates
}

// GetAgentsRequest to get list of agents
message GetAgentsRequest {
  bool include_offline = 1;
}

// GetAgentsResponse contains list of agents
message GetAgentsResponse {
  repeated AgentInfoResponse agents = 1;
}

// GetAgentMetricsRequest to get metrics for specific agent
message GetAgentMetricsRequest {
  string agent_id = 1;
}

// DashboardCommandRequest to send command from dashboard
message DashboardCommandRequest {
  string agent_id = 1;
  Command command = 2;
  string dashboard_user = 3;  // For audit logging
}
